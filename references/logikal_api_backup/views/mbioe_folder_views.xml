<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Folder List View -->
    <record id="view_mbioe_folder_list" model="ir.ui.view">
        <field name="name">mbioe.folder.list</field>
        <field name="model">mbioe.folder</field>
        <field name="arch" type="xml">
            <list string="MBIOE Folders" default_order="full_path" multi_edit="1">
                <header>
                    <button name="action_bulk_exclude_from_sync" type="object" string="Exclude from Sync" 
                            class="btn-warning" icon="fa-ban"/>
                    <button name="action_bulk_include_in_sync" type="object" string="Include in Sync" 
                            class="btn-success" icon="fa-check"/>
                </header>
                <field name="name"/>
                <field name="full_path"/>
                <field name="parent_id"/>
                <field name="level"/>
                <field name="child_count" string="Subfolders"/>
                <field name="project_count" string="Projects"/>
                <field name="exclude_from_sync" widget="boolean_toggle"/>
                <field name="sync_status_display" string="Sync Status"/>
                <field name="synced_at"/>
                <field name="api_source"/>
            </list>
        </field>
    </record>

    <!-- Folder Form View -->
    <record id="view_mbioe_folder_form" model="ir.ui.view">
        <field name="name">mbioe.folder.form</field>
        <field name="model">mbioe.folder</field>
        <field name="arch" type="xml">
            <form string="MBIOE Folder" create="false" delete="false">
                <header>
                    <button name="action_toggle_sync_exclusion" type="object" string="Toggle Sync Status" 
                            class="btn-primary" icon="fa-toggle-on" invisible="exclude_from_sync"/>
                    <button name="action_toggle_sync_exclusion" type="object" string="Toggle Sync Status" 
                            class="btn-secondary" icon="fa-toggle-off" invisible="not exclude_from_sync"/>
                    <div class="oe_title">
                        <h1>
                            <field name="name" readonly="1"/>
                        </h1>
                        <h3 class="text-muted">
                            <field name="full_path" readonly="1"/>
                        </h3>
                    </div>
                </header>
                
                <sheet>
                    <!-- Folder Information -->
                    <group string="Folder Information">
                        <group col="4">
                            <field name="identifier" string="MBIOE ID"/>
                            <field name="api_source" string="Source"/>
                            <field name="level" string="Level"/>
                            <field name="synced_at" string="Last Sync"/>
                        </group>
                    </group>
                    
                    <!-- Sync Settings -->
                    <group string="Sync Settings">
                        <group col="2">
                            <field name="exclude_from_sync" widget="boolean_toggle"/>
                            <field name="sync_status_display" readonly="1"/>
                        </group>
                    </group>
                    
                    <!-- Hierarchy Information -->
                    <group string="Hierarchy" invisible="not parent_id and child_count == 0">
                        <group col="2">
                            <field name="parent_id" readonly="1" invisible="not parent_id"/>
                            <field name="child_count" string="Subfolders" readonly="1" invisible="child_count == 0"/>
                        </group>
                    </group>
                    
                    <!-- Statistics -->
                    <group string="Statistics">
                        <group col="2">
                            <field name="project_count" string="Projects" readonly="1"/>
                        </group>
                    </group>
                    
                    <!-- Child Folders -->
                    <notebook invisible="child_count == 0">
                        <page string="Subfolders" invisible="child_count == 0">
                            <field name="child_ids" readonly="1">
                                <list>
                                    <field name="name"/>
                                    <field name="full_path"/>
                                    <field name="child_count" string="Subfolders"/>
                                    <field name="project_count" string="Projects"/>
                                    <field name="exclude_from_sync" widget="boolean_toggle"/>
                                    <field name="sync_status_display" string="Sync Status"/>
                                    <field name="synced_at"/>
                                </list>
                            </field>
                        </page>
                        
                        <page string="Projects" invisible="project_count == 0">
                            <field name="project_ids" readonly="1">
                                <list>
                                    <field name="name"/>
                                    <field name="identifier"/>
                                    <field name="synced_at"/>
                                </list>
                            </field>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Folder Search View -->
    <record id="view_mbioe_folder_search" model="ir.ui.view">
        <field name="name">mbioe.folder.search</field>
        <field name="model">mbioe.folder</field>
        <field name="arch" type="xml">
            <search string="Search Folders">
                <field name="name" string="Folder Name"/>
                <field name="full_path" string="Path"/>
                <field name="parent_id" string="Parent Folder"/>
                <field name="identifier" string="MBIOE ID"/>
                
                <filter string="Root Folders" name="root_folders" domain="[('parent_id', '=', False)]"/>
                <filter string="Has Subfolders" name="has_children" domain="[('child_count', '>', 0)]"/>
                <filter string="Has Projects" name="has_projects" domain="[('project_count', '>', 0)]"/>
                <filter string="Recently Synced" name="recent_sync" 
                        domain="[('synced_at', '>=', (context_today() - datetime.timedelta(days=7)).strftime('%Y-%m-%d'))]"/>
                
                <separator/>
                <filter string="Included in Sync" name="included_sync" domain="[('exclude_from_sync', '=', False)]"/>
                <filter string="Excluded from Sync" name="excluded_sync" domain="[('exclude_from_sync', '=', True)]"/>
                
                <separator/>
                <filter string="Level 0 (Root)" name="level_0" domain="[('level', '=', 0)]"/>
                <filter string="Level 1" name="level_1" domain="[('level', '=', 1)]"/>
                <filter string="Level 2" name="level_2" domain="[('level', '=', 2)]"/>
                <filter string="Level 3+" name="level_3_plus" domain="[('level', '>=', 3)]"/>
                
                <group expand="1" string="Group By">
                    <filter string="Parent Folder" name="group_parent" context="{'group_by': 'parent_id'}"/>
                    <filter string="Level" name="group_level" context="{'group_by': 'level'}"/>
                    <filter string="Sync Status" name="group_sync_status" context="{'group_by': 'sync_status_display'}"/>
                    <filter string="Sync Date" name="group_sync_date" context="{'group_by': 'synced_at:day'}"/>
                    <filter string="API Source" name="group_source" context="{'group_by': 'api_source'}"/>
                </group>
            </search>
        </field>
    </record>

</odoo>
